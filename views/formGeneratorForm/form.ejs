<form action='<%= action %>' method="POST" class="formGeneratorForm">
    <fieldset class="field">
        <span class="fieldType">
            <label>Type</label>
            <select name='type_1' onchange='formGeneratorFormChangeType(this);'>
                <% var types = [
                    "text", "password",
                    "textarea",
                    "select", "checkboxes", "radios",
                    "date", "datetime-local",
                    "submit", "reset", "button"
                ]; 
                for(i in types) { %>
                <option value="<%= types[i] %>"><%= types[i].charAt(0).toUpperCase() + types[i].slice(1); %></option>
                <% }
                %>
            </select>
        </span>
        <span class="fieldName">
            <label>Name</label>
            <input type="text" name="name_1">
        </span>
        <span class="fieldLabel">
            <label>Label</label>
            <input type="text" name="label_1">
        </span>
        <span class="fieldDisabled">
            <label>Disabled</label>
            <input type="checkbox" name="disabled_1">
        </span>
        <span class="fieldRequired">
            <label>Required</label>
            <input type="checkbox" name="required_1">
        </span>
        <div class="fieldOptions" style="display: none;">
            <label>Options</label>
            <span class="optionPlus" onclick='formGeneratorFormAddOption(this);'>+</span>
            <div class="optionsOption">
                <span class="optionNumber">1</span>
                <input type="text" name="option_1_Value1" class="value" placeholder="value" size="4">&nbsp;:&nbsp;
                <input type="text" name="option_1_Text1" class="text" placeholder="text" size="10">
                <input type="checkbox" name="option_1_Selected1" class="selected">&nbsp;selected
            </div>
        </div>
    </fieldset>
    <span class='formGeneratorFormAddField' onclick='formGeneratorFormAddField();'><i>+ Add field</i></span>
    <br/>
    <% if(!wantString) { %><label for='formGeneratorSeparator'>Separator : <input type="text" size="6" name="formGeneratorSeparator"></label><% } %>
    <br/>
    <br/>
    <input type="hidden" name="wantString" value="<%= wantString ? 'true' : 'false' %>">
    <input type="submit" value="Generate code">
</form>

<script>
    function formGeneratorFormAddField() {
        $(".formGeneratorFormAddField").before($(".formGeneratorForm .field").eq(0).prop("outerHTML"));
        $(".formGeneratorForm .field").last()/*.reset()*/.find(".fieldOptions").hide();
        $(".formGeneratorForm .field").last().find("select, input").each(function() {
            var id = $(".formGeneratorForm .field").length;
            $(this).prop("name", $(this).prop("name").replace(/_\d/, "_" + id));
        });
    }
    
    function formGeneratorFormChangeType(that) {
        var field = $(that).parents(".field");
        var value = $(that).val();
        if(["select", "checkboxes", "radios"].indexOf(value) >= 0) {
            field.find(".fieldOptions").slideDown('fast');
        } else {
            field.find(".fieldOptions").slideUp('fast');
        }
    }
    
    function formGeneratorFormAddOption(that) {
        var optionsDiv = $(that).parent(".fieldOptions");
        var optionsQty = optionsDiv.find(".optionsOption").length + 1;
        optionsDiv.append(optionsDiv.find(".optionsOption").last().prop('outerHTML'));
        optionsDiv.find(".optionsOption").last().find("input").val("").prop("checked", false);
        optionsDiv.find(".optionsOption").last().find("input.selected").val(optionsQty);
        optionsDiv.find(".optionsOption").last().find(".optionNumber").text(optionsQty);
        optionsDiv.find(".optionsOption").last().find("select, input").each(function() {
            $(this).prop("name", $(this).prop("name").replace(/\d$/, optionsQty));
        });
    }
</script>